library(devtools)
getwd()
library(cyphr)
library(sodium)
# Create precomputed weights (example)
cartex_200 = read.csv("/Users/hima/Desktop/Hima/cartex_project/2021-07-11-exploring-genelist-from-cluster5/cartex_200.csv", header = TRUE)
precomputed_weights <- cartex_200$PC1
names(precomputed_weights) <- cartex_200$X
key <- cyphr::key_sodium(sodium::keygen())
# encrypted_data <- cyphr::encrypt(saveRDS(precomputed_weights, "/Users/hima/Documents/CARTEx/extdata/weights_encrypted.rds"), key)
cyphr::encrypt(saveRDS(precomputed_weights, "/Users/hima/Documents/CARTEx/extdata/weights_encrypted.rds"), key)
# saveRDS(encrypted_data, "/Users/hima/Documents/CARTEx/extdata/weights_encrypted.rds")
saveRDS(key, "/Users/hima/Documents/CARTEx/extdata/encryption_key.rds")
load_all()
system.file("extdata", "weights_encrypted.rds", package = "CARTEx")
system.file("extdata", "encryption_key.rds", package = "CARTEx")  # Hidden inside package
document()
check()
install()
# Annotation of rownames
edata=read.csv("/Users/hima/Desktop/2018-10-23-log2TPM_combat-file.csv", header=T, row.names=1)
edata=edata[,order(colnames(edata))]
base_dir = "/Users/hima/Desktop/"
annotation <- file.path(base_dir,"GENCODE.V27_Annotation.csv")
annotation = read.csv(annotation,header=T)
anno=annotation[match(rownames(edata), annotation$EnsembleGeneID),]
all(rownames(edata) == anno$EnsembleGeneID)
rownames(edata) <- make.names(anno$GeneName, unique = TRUE)
dim(edata)
edata[1:3, 1:3]
devtools::install("/Users/hima/Documents/CARTEx")
library(CARTEx)
df4 <- cartex_score(edata)
system.file("extdata", "weights_encrypted.rds", package = "CARTEx")
devtools::install("/Users/hima/Documents/CARTEx")
library(CARTEx)
df1 <- get_weights(edata)
# Annotation of rownames
edata=read.csv("/Users/hima/Desktop/2018-10-23-log2TPM_combat-file.csv", header=T, row.names=1)
edata=edata[,order(colnames(edata))]
base_dir = "/Users/hima/Desktop/"
annotation <- file.path(base_dir,"GENCODE.V27_Annotation.csv")
annotation = read.csv(annotation,header=T)
anno=annotation[match(rownames(edata), annotation$EnsembleGeneID),]
all(rownames(edata) == anno$EnsembleGeneID)
rownames(edata) <- make.names(anno$GeneName, unique = TRUE)
dim(edata)
edata[1:3, 1:3]
df1 <- get_weights(edata)
head(df1)
df4 <- cartex_score(edata)
# Create precomputed weights (example)
cartex_200 = read.csv("/Users/hima/Desktop/Hima/cartex_project/2021-07-11-exploring-genelist-from-cluster5/cartex_200.csv", header = TRUE)
precomputed_weights <- cartex_200$PC1
names(precomputed_weights) <- cartex_200$X
saveRDS(precomputed_weights, "/Users/hima/Documents/CARTEx/extdata/weights.rds")
library(devtools)
load_all()
document()
check()
check()
install()
library(CARTEx)
df1 <- get_weights(edata)
devtools::install("/Users/hima/Documents/CARTEx")
library(CARTEx)
# Annotation of rownames
edata=read.csv("/Users/hima/Desktop/2018-10-23-log2TPM_combat-file.csv", header=T, row.names=1)
edata=edata[,order(colnames(edata))]
base_dir = "/Users/hima/Desktop/"
annotation <- file.path(base_dir,"GENCODE.V27_Annotation.csv")
annotation = read.csv(annotation,header=T)
anno=annotation[match(rownames(edata), annotation$EnsembleGeneID),]
all(rownames(edata) == anno$EnsembleGeneID)
rownames(edata) <- make.names(anno$GeneName, unique = TRUE)
dim(edata)
edata[1:3, 1:3]
df1 <- get_weights(edata)
head(df1)
df4 <- cartex_score(edata)
system.file("extdata", "weights.rds", package = "CARTEx")
load_all
load_all()
library(devtools)
load_all()
system.file("extdata", "weights.rds", package = "CARTEx")
df4 <- cartex_score(edata)
pdata <- read.csv("/Users/hima/Desktop/2018-10-19-combined-pheno-all-data.csv", header=T, row.names=1)
dim(pdata)
load_all()
df4 <- cartex_score(edata)
head(df4)
df5 <- cartex_score(edata, pdata)
head(df5)
# new data selection
df5=df5[df5$COSTIMULATORY=="28Z",]
df5=df5[!(df5$DATATYPE == "Bulk"),]
df5=df5[!(df5$CAR == "GD2"),]
df5=df5[(df5$COMPARTMENT == "Naive"),]
table(df5$COMPARTMENT)
table(df5$Experiment_CAR)
df5=df5[!(df5$CELLTYPE == "CD4"),]
table(df5$COMPARTMENT)
table(df5$Experiment_CAR)
ggplot(df5, aes(x=Experiment_CAR, y=cartex_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
library(cowplot)
library(ggplot2)
ggplot(df5, aes(x=Experiment_CAR, y=cartex_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
library(ggplot2)
library(ggpubr)
ggplot(df5, aes(x=Experiment_CAR, y=cartex_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
ggplot(df5, aes(x=Experiment_CAR, y=pca_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
scores <- read.csv("/Users/hima/Desktop/cartex_2024/Figure3_data/Figure3A_plot_data_Lynn_et_al_Nature_2019.csv")
head(scores)
table(df5$Experiment_CAR)
table(scores$Experiment_CAR)
df5 <- cartex_score(edata, pdata)
# Can I replicate the figure 3A of the paper?
# All plots together
library(cowplot)
library(ggplot2)
library(ggpubr)
# new data selection
df5=df5[df5$COSTIMULATORY=="28Z",]
df5=df5[!(df5$DATATYPE == "Bulk"),]
df5=df5[!(df5$CAR == "GD2"),]
df5=df5[!(df5$CELLTYPE == "CD4"),]
df5=df5[(df5$COMPARTMENT == "Naive"),]
table(df5$COMPARTMENT)
table(df5$Experiment_CAR)
subset <- scores[,colnames(scores) %in% c("Experiment_CAR", "pca_score","TIMEPOINT")]
colnames(subset)[which(names(subset) == "scaled")] <- "cartex_score"
table(subset$Experiment_CAR)
subset <- subset %>%
mutate(Experiment_CAR = recode(Experiment_CAR, "No_CAR" = "Control", "CD19_28Z" = "CD19", "HA_28Z" = "HA"))
# All plots together
library(cowplot)
library(ggplot2)
library(ggpubr)
library(dplyr)
# new data selection
df5=df5[df5$COSTIMULATORY=="28Z",]
df5=df5[!(df5$DATATYPE == "Bulk"),]
df5=df5[!(df5$CAR == "GD2"),]
df5=df5[!(df5$CELLTYPE == "CD4"),]
df5=df5[(df5$COMPARTMENT == "Naive"),]
table(df5$COMPARTMENT)
table(df5$Experiment_CAR)
subset <- scores[,colnames(scores) %in% c("Experiment_CAR", "pca_score","TIMEPOINT")]
colnames(subset)[which(names(subset) == "scaled")] <- "cartex_score"
table(subset$Experiment_CAR)
subset <- subset %>%
mutate(Experiment_CAR = recode(Experiment_CAR, "No_CAR" = "Control", "CD19_28Z" = "CD19", "HA_28Z" = "HA"))
subset$Experiment_CAR <- factor(subset$Experiment_CAR, levels = c("Control", "CD19", "HA"))
subset$TIMEPOINT <- factor(subset$TIMEPOINT, levels = c("D7", "D10", "D14"))
subset <- df5[,colnames(df5) %in% c("Experiment_CAR", "pca_score","TIMEPOINT")]
colnames(subset)[which(names(subset) == "scaled")] <- "cartex_score"
table(subset$Experiment_CAR)
subset <- subset %>%
mutate(Experiment_CAR = recode(Experiment_CAR, "No_CAR" = "Control", "CD19_28Z" = "CD19", "HA_28Z" = "HA"))
subset$Experiment_CAR <- factor(subset$Experiment_CAR, levels = c("Control", "CD19", "HA"))
subset$TIMEPOINT <- factor(subset$TIMEPOINT, levels = c("D7", "D10", "D14"))
ggplot(subset, aes(x=Experiment_CAR, y=cartex_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
ggplot(subset, aes(x=Experiment_CAR, y=pca_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
seed(123)
set.seed(123)
ggplot(subset, aes(x=Experiment_CAR, y=cartex_score)) +
geom_boxplot(outliers = FALSE) +
geom_jitter(stat = "identity", aes(color = Experiment_CAR, shape = TIMEPOINT), size = 3, width = 0.3) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','CD19')), label = "p.signif", label.y = 1.8) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('HA','Control')), label = "p.signif", label.y = 2.2) +
stat_compare_means(method = "wilcox.test", comparisons = list(c('Control','CD19')), label = "p.signif", label.y = 2.0) +
# scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod'), labels = c("No_CAR" = "Control", "CD19" = "CD19", "HA" = "HA")) +
scale_color_manual(values = c('CD19' = 'dodgerblue', 'HA' = 'indianred', 'Control' = 'darkgoldenrod')) +
scale_shape_manual(values = c('D7' = 5, 'D10' = 1, 'D14' = 2)) +
xlab(NULL) + ylab("CARTEx") + ylim(-2.5,2.5) + theme_classic() +
labs(color = "CAR", shape="Day") +
guides(
color = guide_legend(order = 1),  # Color legend first
shape = guide_legend(order = 2)   # Shape legend second
)
load_all()
scores <- read.csv("/Users/hima/Desktop/cartex_2024/Figure3_data/Figure3A_plot_data_Lynn_et_al_Nature_2019.csv")
head(scores)
table(scores$Experiment_CAR)
scores$cartex_score
length(scores$cartex_score)
library(CARTEx)
df5 <- cartex_score(edata, pdata)
df5$cartex_score
# new data selection
df5=df5[df5$COSTIMULATORY=="28Z",]
df5=df5[!(df5$DATATYPE == "Bulk"),]
df5=df5[!(df5$CAR == "GD2"),]
df5=df5[!(df5$CELLTYPE == "CD4"),]
df5=df5[(df5$COMPARTMENT == "Naive"),]
df5$cartex_score
subset <- df5[,colnames(df5) %in% c("Experiment_CAR", "cartex_score","TIMEPOINT")]
head(subset)
head(scores)
subset
scores
